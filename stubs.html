
<!DOCTYPE html>

<html lang="zh_CN">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Stub files &#8212; Mypy 0.940+dev.d02f39d1f0317448dbbec1e7a5417a3780c278f2 文档</title>
    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="_static/classic.css" />
    
    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/translations.js"></script>
    
    <link rel="index" title="索引" href="genindex.html" />
    <link rel="search" title="搜索" href="search.html" />
    <link rel="next" title="泛型" href="generics.html" />
    <link rel="prev" title="Duck type compatibility" href="duck_type_compatibility.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>导航</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="总目录"
             accesskey="I">索引</a></li>
        <li class="right" >
          <a href="generics.html" title="泛型"
             accesskey="N">下一页</a> |</li>
        <li class="right" >
          <a href="duck_type_compatibility.html" title="Duck type compatibility"
             accesskey="P">上一页</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">Mypy 0.940+dev.d02f39d1f0317448dbbec1e7a5417a3780c278f2 文档</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">Stub files</a></li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <section id="stub-files">
<span id="id1"></span><h1>Stub files<a class="headerlink" href="#stub-files" title="永久链接至标题">¶</a></h1>
<p>Mypy uses stub files stored in the
<a class="reference external" href="https://github.com/python/typeshed">typeshed</a> repository to determine
the types of standard library and third-party library functions, classes,
and other definitions. You can also create your own stubs that will be
used to type check your code. The basic properties of stubs were introduced
back in <a class="reference internal" href="getting_started.html#stubs-intro"><span class="std std-ref">Library stubs and typeshed</span></a>.</p>
<section id="creating-a-stub">
<h2>Creating a stub<a class="headerlink" href="#creating-a-stub" title="永久链接至标题">¶</a></h2>
<p>Here is an overview of how to create a stub file:</p>
<ul>
<li><p>Write a stub file for the library (or an arbitrary module) and store it as
a <code class="docutils literal notranslate"><span class="pre">.pyi</span></code> file in the same directory as the library module.</p></li>
<li><p>Alternatively, put your stubs (<code class="docutils literal notranslate"><span class="pre">.pyi</span></code> files) in a directory
reserved for stubs (e.g., <code class="file docutils literal notranslate"><span class="pre">myproject/stubs</span></code>). In this case you
have to set the environment variable <code class="docutils literal notranslate"><span class="pre">MYPYPATH</span></code> to refer to the
directory.  For example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ export MYPYPATH=~/work/myproject/stubs
</pre></div>
</div>
</li>
</ul>
<p>Use the normal Python file name conventions for modules, e.g. <code class="file docutils literal notranslate"><span class="pre">csv.pyi</span></code>
for module <code class="docutils literal notranslate"><span class="pre">csv</span></code>. Use a subdirectory with <code class="file docutils literal notranslate"><span class="pre">__init__.pyi</span></code> for packages. Note
that <span class="target" id="index-0"></span><a class="pep reference external" href="https://www.python.org/dev/peps/pep-0561"><strong>PEP 561</strong></a> stub-only packages must be installed, and may not be pointed
at through the <code class="docutils literal notranslate"><span class="pre">MYPYPATH</span></code> (see <a class="reference internal" href="installed_packages.html#installed-packages"><span class="std std-ref">PEP 561 support</span></a>).</p>
<p>If a directory contains both a <code class="docutils literal notranslate"><span class="pre">.py</span></code> and a <code class="docutils literal notranslate"><span class="pre">.pyi</span></code> file for the
same module, the <code class="docutils literal notranslate"><span class="pre">.pyi</span></code> file takes precedence. This way you can
easily add annotations for a module even if you don’t want to modify
the source code. This can be useful, for example, if you use 3rd party
open source libraries in your program (and there are no stubs in
typeshed yet).</p>
<p>That’s it!</p>
<p>Now you can access the module in mypy programs and type check
code that uses the library. If you write a stub for a library module,
consider making it available for other programmers that use mypy
by contributing it back to the typeshed repo.</p>
<p>Mypy also ships with two tools for making it easier to create and maintain
stubs: <a class="reference internal" href="stubgen.html#stubgen"><span class="std std-ref">Automatic stub generation (stubgen)</span></a> and <a class="reference internal" href="stubtest.html#stubtest"><span class="std std-ref">Automatic stub testing (stubtest)</span></a>.</p>
<p>The following sections explain the kinds of type annotations you can use
in your programs and stub files.</p>
<div class="admonition note">
<p class="admonition-title">备注</p>
<p>You may be tempted to point <code class="docutils literal notranslate"><span class="pre">MYPYPATH</span></code> to the standard library or
to the <code class="file docutils literal notranslate"><span class="pre">site-packages</span></code> directory where your 3rd party packages
are installed. This is almost always a bad idea – you will likely
get tons of error messages about code you didn’t write and that
mypy can’t analyze all that well yet, and in the worst case
scenario mypy may crash due to some construct in a 3rd party
package that it didn’t expect.</p>
</div>
</section>
<section id="stub-file-syntax">
<h2>Stub file syntax<a class="headerlink" href="#stub-file-syntax" title="永久链接至标题">¶</a></h2>
<p>Stub files are written in normal Python 3 syntax, but generally
leaving out runtime logic like variable initializers, function bodies,
and default arguments.</p>
<p>If it is not possible to completely leave out some piece of runtime
logic, the recommended convention is to replace or elide them with ellipsis
expressions (<code class="docutils literal notranslate"><span class="pre">...</span></code>). Each ellipsis below is literally written in the
stub file as three dots:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Variables with annotations do not need to be assigned a value.</span>
<span class="c1"># So by convention, we omit them in the stub file.</span>
<span class="n">x</span><span class="p">:</span> <span class="nb">int</span>

<span class="c1"># Function bodies cannot be completely removed. By convention,</span>
<span class="c1"># we replace them with `...` instead of the `pass` statement.</span>
<span class="k">def</span> <span class="nf">func_1</span><span class="p">(</span><span class="n">code</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span> <span class="o">...</span>

<span class="c1"># We can do the same with default arguments.</span>
<span class="k">def</span> <span class="nf">func_2</span><span class="p">(</span><span class="n">a</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">b</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="o">...</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span> <span class="o">...</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">备注</p>
<p>The ellipsis <code class="docutils literal notranslate"><span class="pre">...</span></code> is also used with a different meaning in
<a class="reference internal" href="kinds_of_types.html#callable-types"><span class="std std-ref">callable types</span></a> and <a class="reference internal" href="kinds_of_types.html#tuple-types"><span class="std std-ref">tuple types</span></a>.</p>
</div>
<div class="admonition note">
<p class="admonition-title">备注</p>
<p>It is always legal to use Python 3 syntax in stub files, even when
writing Python 2 code. The example above is a valid stub file
for both Python 2 and 3.</p>
</div>
</section>
<section id="using-stub-file-syntax-at-runtime">
<h2>Using stub file syntax at runtime<a class="headerlink" href="#using-stub-file-syntax-at-runtime" title="永久链接至标题">¶</a></h2>
<p>You may also occasionally need to elide actual logic in regular
Python code – for example, when writing methods in
<a class="reference internal" href="more_types.html#function-overloading"><span class="std std-ref">overload variants</span></a> or
<a class="reference internal" href="protocols.html#protocol-types"><span class="std std-ref">custom protocols</span></a>.</p>
<p>The recommended style is to use ellipses to do so, just like in
stub files. It is also considered stylistically acceptable to
throw a <a class="reference external" href="https://docs.python.org/3/library/exceptions.html#NotImplementedError" title="(在 Python v3.10)"><code class="xref py py-exc docutils literal notranslate"><span class="pre">NotImplementedError</span></code></a> in cases where the user of the
code may accidentally call functions with no actual logic.</p>
<p>You can also elide default arguments as long as the function body
also contains no runtime logic: the function body only contains
a single ellipsis, the pass statement, or a <code class="docutils literal notranslate"><span class="pre">raise</span> <span class="pre">NotImplementedError()</span></code>.
It is also acceptable for the function body to contain a docstring.
For example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">typing_extensions</span> <span class="kn">import</span> <span class="n">Protocol</span>

<span class="k">class</span> <span class="nc">Resource</span><span class="p">(</span><span class="n">Protocol</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">ok_1</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">foo</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="o">...</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span> <span class="o">...</span>

    <span class="k">def</span> <span class="nf">ok_2</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">foo</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="o">...</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">ok_3</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">foo</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="o">...</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Some docstring&quot;&quot;&quot;</span>
        <span class="k">pass</span>

    <span class="c1"># Error: Incompatible default for argument &quot;foo&quot; (default has</span>
    <span class="c1"># type &quot;ellipsis&quot;, argument has type &quot;list[str]&quot;)</span>
    <span class="k">def</span> <span class="nf">not_ok</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">foo</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="o">...</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">foo</span><span class="p">)</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">备注</p>
<p>Ellipsis expressions are legal syntax in Python 3 only. This means
it is not possible to elide default arguments in Python 2 code.
You can still elide function bodies in Python 2 by using either
the <code class="docutils literal notranslate"><span class="pre">pass</span></code> statement or by throwing a <a class="reference external" href="https://docs.python.org/3/library/exceptions.html#NotImplementedError" title="(在 Python v3.10)"><code class="xref py py-exc docutils literal notranslate"><span class="pre">NotImplementedError</span></code></a>.</p>
</div>
</section>
</section>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <div>
    <h3><a href="index.html">目录</a></h3>
    <ul>
<li><a class="reference internal" href="#">Stub files</a><ul>
<li><a class="reference internal" href="#creating-a-stub">Creating a stub</a></li>
<li><a class="reference internal" href="#stub-file-syntax">Stub file syntax</a></li>
<li><a class="reference internal" href="#using-stub-file-syntax-at-runtime">Using stub file syntax at runtime</a></li>
</ul>
</li>
</ul>

  </div>
  <div>
    <h4>上一个主题</h4>
    <p class="topless"><a href="duck_type_compatibility.html"
                          title="上一章">Duck type compatibility</a></p>
  </div>
  <div>
    <h4>下一个主题</h4>
    <p class="topless"><a href="generics.html"
                          title="下一章">泛型</a></p>
  </div>
  <div role="note" aria-label="source link">
    <h3>本页</h3>
    <ul class="this-page-menu">
      <li><a href="_sources/stubs.rst.txt"
            rel="nofollow">显示源代码</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">快速搜索</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="转向" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>导航</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="总目录"
             >索引</a></li>
        <li class="right" >
          <a href="generics.html" title="泛型"
             >下一页</a> |</li>
        <li class="right" >
          <a href="duck_type_compatibility.html" title="Duck type compatibility"
             >上一页</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">Mypy 0.940+dev.d02f39d1f0317448dbbec1e7a5417a3780c278f2 文档</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">Stub files</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; 版权所有 2016, Jukka Lehtosalo.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 4.4.0.
    </div>
  </body>
</html>