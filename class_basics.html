
<!DOCTYPE html>

<html lang="zh_CN">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Class basics &#8212; Mypy 0.940+dev.7f0839b552c99f62636632bfd44522e91b26dc54 文档</title>
    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="_static/classic.css" />
    
    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/translations.js"></script>
    
    <link rel="index" title="索引" href="genindex.html" />
    <link rel="search" title="搜索" href="search.html" />
    <link rel="next" title="Annotation issues at runtime" href="runtime_troubles.html" />
    <link rel="prev" title="Kinds of types" href="kinds_of_types.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>导航</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="总目录"
             accesskey="I">索引</a></li>
        <li class="right" >
          <a href="runtime_troubles.html" title="Annotation issues at runtime"
             accesskey="N">下一页</a> |</li>
        <li class="right" >
          <a href="kinds_of_types.html" title="Kinds of types"
             accesskey="P">上一页</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">Mypy 0.940+dev.7f0839b552c99f62636632bfd44522e91b26dc54 文档</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">Class basics</a></li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <section id="class-basics">
<h1>Class basics<a class="headerlink" href="#class-basics" title="永久链接至标题">¶</a></h1>
<p>This section will help get you started annotating your
classes. Built-in classes such as <code class="docutils literal notranslate"><span class="pre">int</span></code> also follow these same
rules.</p>
<section id="instance-and-class-attributes">
<h2>Instance and class attributes<a class="headerlink" href="#instance-and-class-attributes" title="永久链接至标题">¶</a></h2>
<p>The mypy type checker detects if you are trying to access a missing
attribute, which is a very common programming error. For this to work
correctly, instance and class attributes must be defined or
initialized within the class. Mypy infers the types of attributes:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">A</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">x</span>  <span class="c1"># Aha, attribute &#39;x&#39; of type &#39;int&#39;</span>

<span class="n">a</span> <span class="o">=</span> <span class="n">A</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="n">a</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="mi">2</span>  <span class="c1"># OK!</span>
<span class="n">a</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="mi">3</span>  <span class="c1"># Error: &quot;A&quot; has no attribute &quot;y&quot;</span>
</pre></div>
</div>
<p>This is a bit like each class having an implicitly defined
<a class="reference external" href="https://docs.python.org/3/reference/datamodel.html#object.__slots__" title="(在 Python v3.10)"><code class="xref py py-data docutils literal notranslate"><span class="pre">__slots__</span></code></a> attribute. This is only enforced during type
checking and not when your program is running.</p>
<p>You can declare types of variables in the class body explicitly using
a type annotation:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">A</span><span class="p">:</span>
    <span class="n">x</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span>  <span class="c1"># Declare attribute &#39;x&#39; of type list[int]</span>

<span class="n">a</span> <span class="o">=</span> <span class="n">A</span><span class="p">()</span>
<span class="n">a</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">]</span>     <span class="c1"># OK</span>
</pre></div>
</div>
<p>As in Python generally, a variable defined in the class body can be used
as a class or an instance variable. (As discussed in the next section, you
can override this with a <a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.ClassVar" title="(在 Python v3.10)"><code class="xref py py-data docutils literal notranslate"><span class="pre">ClassVar</span></code></a> annotation.)</p>
<p>Type comments work as well, if you need to support Python versions earlier
than 3.6:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">A</span><span class="p">:</span>
    <span class="n">x</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># type: list[int]  # Declare attribute &#39;x&#39; of type list[int]</span>
</pre></div>
</div>
<p>Note that attribute definitions in the class body that use a type comment
are special: a <code class="docutils literal notranslate"><span class="pre">None</span></code> value is valid as the initializer, even though
the declared type is not optional. This should be used sparingly, as this can
result in <code class="docutils literal notranslate"><span class="pre">None</span></code>-related runtime errors that mypy can’t detect.</p>
<p>Similarly, you can give explicit types to instance variables defined
in a method:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">A</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">:</span> <span class="n">Any</span> <span class="o">=</span> <span class="mi">0</span>
</pre></div>
</div>
<p>You can only define an instance variable within a method if you assign
to it explicitly using <code class="docutils literal notranslate"><span class="pre">self</span></code>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">A</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="mi">1</span>   <span class="c1"># Define &#39;y&#39;</span>
        <span class="n">a</span> <span class="o">=</span> <span class="bp">self</span>
        <span class="n">a</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="mi">1</span>      <span class="c1"># Error: &#39;x&#39; not defined</span>
</pre></div>
</div>
</section>
<section id="annotating-init-methods">
<h2>Annotating __init__ methods<a class="headerlink" href="#annotating-init-methods" title="永久链接至标题">¶</a></h2>
<p>The <a class="reference external" href="https://docs.python.org/3/reference/datamodel.html#object.__init__" title="(在 Python v3.10)"><code class="xref py py-meth docutils literal notranslate"><span class="pre">__init__</span></code></a> method is somewhat special – it doesn’t return a
value.  This is best expressed as <code class="docutils literal notranslate"><span class="pre">-&gt;</span> <span class="pre">None</span></code>.  However, since many feel
this is redundant, it is allowed to omit the return type declaration
on <a class="reference external" href="https://docs.python.org/3/reference/datamodel.html#object.__init__" title="(在 Python v3.10)"><code class="xref py py-meth docutils literal notranslate"><span class="pre">__init__</span></code></a> methods <strong>if at least one argument is annotated</strong>.  For
example, in the following classes <a class="reference external" href="https://docs.python.org/3/reference/datamodel.html#object.__init__" title="(在 Python v3.10)"><code class="xref py py-meth docutils literal notranslate"><span class="pre">__init__</span></code></a> is considered fully
annotated:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">C1</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">var</span> <span class="o">=</span> <span class="mi">42</span>

<span class="k">class</span> <span class="nc">C2</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">arg</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">var</span> <span class="o">=</span> <span class="n">arg</span>
</pre></div>
</div>
<p>However, if <a class="reference external" href="https://docs.python.org/3/reference/datamodel.html#object.__init__" title="(在 Python v3.10)"><code class="xref py py-meth docutils literal notranslate"><span class="pre">__init__</span></code></a> has no annotated arguments and no return type
annotation, it is considered an untyped method:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">C3</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># This body is not type checked</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">var</span> <span class="o">=</span> <span class="mi">42</span> <span class="o">+</span> <span class="s1">&#39;abc&#39;</span>
</pre></div>
</div>
</section>
<section id="class-attribute-annotations">
<h2>Class attribute annotations<a class="headerlink" href="#class-attribute-annotations" title="永久链接至标题">¶</a></h2>
<p>You can use a <a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.ClassVar" title="(在 Python v3.10)"><code class="xref py py-data docutils literal notranslate"><span class="pre">ClassVar[t]</span></code></a> annotation to explicitly declare that a
particular attribute should not be set on instances:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">ClassVar</span>

<span class="k">class</span> <span class="nc">A</span><span class="p">:</span>
    <span class="n">x</span><span class="p">:</span> <span class="n">ClassVar</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c1"># Class variable only</span>

<span class="n">A</span><span class="o">.</span><span class="n">x</span> <span class="o">+=</span> <span class="mi">1</span>  <span class="c1"># OK</span>

<span class="n">a</span> <span class="o">=</span> <span class="n">A</span><span class="p">()</span>
<span class="n">a</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="mi">1</span>  <span class="c1"># Error: Cannot assign to class variable &quot;x&quot; via instance</span>
<span class="nb">print</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">x</span><span class="p">)</span>  <span class="c1"># OK -- can be read through an instance</span>
</pre></div>
</div>
<p>It’s not necessary to annotate all class variables using
<a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.ClassVar" title="(在 Python v3.10)"><code class="xref py py-data docutils literal notranslate"><span class="pre">ClassVar</span></code></a>. An attribute without the <a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.ClassVar" title="(在 Python v3.10)"><code class="xref py py-data docutils literal notranslate"><span class="pre">ClassVar</span></code></a> annotation can
still be used as a class variable. However, mypy won’t prevent it from
being used as an instance variable, as discussed previously:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">A</span><span class="p">:</span>
    <span class="n">x</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c1"># Can be used as a class or instance variable</span>

<span class="n">A</span><span class="o">.</span><span class="n">x</span> <span class="o">+=</span> <span class="mi">1</span>  <span class="c1"># OK</span>

<span class="n">a</span> <span class="o">=</span> <span class="n">A</span><span class="p">()</span>
<span class="n">a</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="mi">1</span>  <span class="c1"># Also OK</span>
</pre></div>
</div>
<p>Note that <a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.ClassVar" title="(在 Python v3.10)"><code class="xref py py-data docutils literal notranslate"><span class="pre">ClassVar</span></code></a> is not a class, and you can’t use it with
<a class="reference external" href="https://docs.python.org/3/library/functions.html#isinstance" title="(在 Python v3.10)"><code class="xref py py-func docutils literal notranslate"><span class="pre">isinstance()</span></code></a> or <a class="reference external" href="https://docs.python.org/3/library/functions.html#issubclass" title="(在 Python v3.10)"><code class="xref py py-func docutils literal notranslate"><span class="pre">issubclass()</span></code></a>. It does not change Python
runtime behavior – it’s only for type checkers such as mypy (and
also helpful for human readers).</p>
<p>You can also omit the square brackets and the variable type in
a <a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.ClassVar" title="(在 Python v3.10)"><code class="xref py py-data docutils literal notranslate"><span class="pre">ClassVar</span></code></a> annotation, but this might not do what you’d expect:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">A</span><span class="p">:</span>
    <span class="n">y</span><span class="p">:</span> <span class="n">ClassVar</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c1"># Type implicitly Any!</span>
</pre></div>
</div>
<p>In this case the type of the attribute will be implicitly <code class="docutils literal notranslate"><span class="pre">Any</span></code>.
This behavior will change in the future, since it’s surprising.</p>
<div class="admonition note">
<p class="admonition-title">备注</p>
<p>A <a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.ClassVar" title="(在 Python v3.10)"><code class="xref py py-data docutils literal notranslate"><span class="pre">ClassVar</span></code></a> type parameter cannot include type variables:
<code class="docutils literal notranslate"><span class="pre">ClassVar[T]</span></code> and <code class="docutils literal notranslate"><span class="pre">ClassVar[list[T]]</span></code>
are both invalid if <code class="docutils literal notranslate"><span class="pre">T</span></code> is a type variable (see <a class="reference internal" href="generics.html#generic-classes"><span class="std std-ref">定义泛型类</span></a>
for more about type variables).</p>
</div>
</section>
<section id="overriding-statically-typed-methods">
<h2>Overriding statically typed methods<a class="headerlink" href="#overriding-statically-typed-methods" title="永久链接至标题">¶</a></h2>
<p>When overriding a statically typed method, mypy checks that the
override has a compatible signature:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Base</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="o">...</span>

<span class="k">class</span> <span class="nc">Derived1</span><span class="p">(</span><span class="n">Base</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>   <span class="c1"># Error: type of &#39;x&#39; incompatible</span>
        <span class="o">...</span>

<span class="k">class</span> <span class="nc">Derived2</span><span class="p">(</span><span class="n">Base</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>  <span class="c1"># Error: too many arguments</span>
        <span class="o">...</span>

<span class="k">class</span> <span class="nc">Derived3</span><span class="p">(</span><span class="n">Base</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>   <span class="c1"># OK</span>
        <span class="o">...</span>

<span class="k">class</span> <span class="nc">Derived4</span><span class="p">(</span><span class="n">Base</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>   <span class="c1"># OK: mypy treats int as a subtype of float</span>
        <span class="o">...</span>

<span class="k">class</span> <span class="nc">Derived5</span><span class="p">(</span><span class="n">Base</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>   <span class="c1"># OK: accepts more than the base</span>
        <span class="o">...</span>                                    <span class="c1">#     class method</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">备注</p>
<p>You can also vary return types <strong>covariantly</strong> in overriding. For
example, you could override the return type <code class="docutils literal notranslate"><span class="pre">Iterable[int]</span></code> with a
subtype such as <code class="docutils literal notranslate"><span class="pre">list[int]</span></code>. Similarly, you can vary argument types
<strong>contravariantly</strong> – subclasses can have more general argument types.</p>
</div>
<p>You can also override a statically typed method with a dynamically
typed one. This allows dynamically typed code to override methods
defined in library classes without worrying about their type
signatures.</p>
<p>As always, relying on dynamically typed code can be unsafe. There is no
runtime enforcement that the method override returns a value that is
compatible with the original return type, since annotations have no
effect at runtime:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Base</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">inc</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">x</span> <span class="o">+</span> <span class="mi">1</span>

<span class="k">class</span> <span class="nc">Derived</span><span class="p">(</span><span class="n">Base</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">inc</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>   <span class="c1"># Override, dynamically typed</span>
        <span class="k">return</span> <span class="s1">&#39;hello&#39;</span>  <span class="c1"># Incompatible with &#39;Base&#39;, but no mypy error</span>
</pre></div>
</div>
</section>
<section id="abstract-base-classes-and-multiple-inheritance">
<h2>Abstract base classes and multiple inheritance<a class="headerlink" href="#abstract-base-classes-and-multiple-inheritance" title="永久链接至标题">¶</a></h2>
<p>Mypy supports Python <a class="reference external" href="https://docs.python.org/3/library/abc.html" title="(在 Python v3.10)"><span class="xref std std-doc">abstract base classes</span></a> (ABCs). Abstract classes
have at least one abstract method or property that must be implemented
by any <em>concrete</em> (non-abstract) subclass. You can define abstract base
classes using the <a class="reference external" href="https://docs.python.org/3/library/abc.html#abc.ABCMeta" title="(在 Python v3.10)"><code class="xref py py-class docutils literal notranslate"><span class="pre">abc.ABCMeta</span></code></a> metaclass and the <a class="reference external" href="https://docs.python.org/3/library/abc.html#abc.abstractmethod" title="(在 Python v3.10)"><code class="xref py py-func docutils literal notranslate"><span class="pre">&#64;abc.abstractmethod</span></code></a>
function decorator. Example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">abc</span> <span class="kn">import</span> <span class="n">ABCMeta</span><span class="p">,</span> <span class="n">abstractmethod</span>

<span class="k">class</span> <span class="nc">Animal</span><span class="p">(</span><span class="n">metaclass</span><span class="o">=</span><span class="n">ABCMeta</span><span class="p">):</span>
    <span class="nd">@abstractmethod</span>
    <span class="k">def</span> <span class="nf">eat</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">food</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span> <span class="k">pass</span>

    <span class="nd">@property</span>
    <span class="nd">@abstractmethod</span>
    <span class="k">def</span> <span class="nf">can_walk</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span> <span class="k">pass</span>

<span class="k">class</span> <span class="nc">Cat</span><span class="p">(</span><span class="n">Animal</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">eat</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">food</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="o">...</span>  <span class="c1"># Body omitted</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">can_walk</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">True</span>

<span class="n">x</span> <span class="o">=</span> <span class="n">Animal</span><span class="p">()</span>  <span class="c1"># Error: &#39;Animal&#39; is abstract due to &#39;eat&#39; and &#39;can_walk&#39;</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">Cat</span><span class="p">()</span>     <span class="c1"># OK</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">备注</p>
<p>In Python 2.7 you have to use <a class="reference external" href="https://docs.python.org/3/library/abc.html#abc.abstractproperty" title="(在 Python v3.10)"><code class="xref py py-func docutils literal notranslate"><span class="pre">&#64;abc.abstractproperty</span></code></a> to define
an abstract property.</p>
</div>
<p>Note that mypy performs checking for unimplemented abstract methods
even if you omit the <a class="reference external" href="https://docs.python.org/3/library/abc.html#abc.ABCMeta" title="(在 Python v3.10)"><code class="xref py py-class docutils literal notranslate"><span class="pre">ABCMeta</span></code></a> metaclass. This can be useful if the
metaclass would cause runtime metaclass conflicts.</p>
<p>Since you can’t create instances of ABCs, they are most commonly used in
type annotations. For example, this method accepts arbitrary iterables
containing arbitrary animals (instances of concrete <code class="docutils literal notranslate"><span class="pre">Animal</span></code>
subclasses):</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">feed_all</span><span class="p">(</span><span class="n">animals</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">[</span><span class="n">Animal</span><span class="p">],</span> <span class="n">food</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">animal</span> <span class="ow">in</span> <span class="n">animals</span><span class="p">:</span>
        <span class="n">animal</span><span class="o">.</span><span class="n">eat</span><span class="p">(</span><span class="n">food</span><span class="p">)</span>
</pre></div>
</div>
<p>There is one important peculiarity about how ABCs work in Python –
whether a particular class is abstract or not is somewhat implicit.
In the example below, <code class="docutils literal notranslate"><span class="pre">Derived</span></code> is treated as an abstract base class
since <code class="docutils literal notranslate"><span class="pre">Derived</span></code> inherits an abstract <code class="docutils literal notranslate"><span class="pre">f</span></code> method from <code class="docutils literal notranslate"><span class="pre">Base</span></code> and
doesn’t explicitly implement it. The definition of <code class="docutils literal notranslate"><span class="pre">Derived</span></code>
generates no errors from mypy, since it’s a valid ABC:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">abc</span> <span class="kn">import</span> <span class="n">ABCMeta</span><span class="p">,</span> <span class="n">abstractmethod</span>

<span class="k">class</span> <span class="nc">Base</span><span class="p">(</span><span class="n">metaclass</span><span class="o">=</span><span class="n">ABCMeta</span><span class="p">):</span>
    <span class="nd">@abstractmethod</span>
    <span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span> <span class="k">pass</span>

<span class="k">class</span> <span class="nc">Derived</span><span class="p">(</span><span class="n">Base</span><span class="p">):</span>  <span class="c1"># No error -- Derived is implicitly abstract</span>
    <span class="k">def</span> <span class="nf">g</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="o">...</span>
</pre></div>
</div>
<p>Attempting to create an instance of <code class="docutils literal notranslate"><span class="pre">Derived</span></code> will be rejected,
however:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">d</span> <span class="o">=</span> <span class="n">Derived</span><span class="p">()</span>  <span class="c1"># Error: &#39;Derived&#39; is abstract</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">备注</p>
<p>It’s a common error to forget to implement an abstract method.
As shown above, the class definition will not generate an error
in this case, but any attempt to construct an instance will be
flagged as an error.</p>
</div>
<p>A class can inherit any number of classes, both abstract and
concrete. As with normal overrides, a dynamically typed method can
override or implement a statically typed method defined in any base
class, including an abstract method defined in an abstract base class.</p>
<p>You can implement an abstract property using either a normal
property or an instance variable.</p>
</section>
<section id="slots">
<h2>Slots<a class="headerlink" href="#slots" title="永久链接至标题">¶</a></h2>
<p>When a class has explicitly defined
<a class="reference external" href="https://docs.python.org/3/reference/datamodel.html#slots">__slots__</a>,
mypy will check that all attributes assigned to are members of <code class="docutils literal notranslate"><span class="pre">__slots__</span></code>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Album</span><span class="p">:</span>
    <span class="vm">__slots__</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;year&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">year</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
       <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
       <span class="bp">self</span><span class="o">.</span><span class="n">year</span> <span class="o">=</span> <span class="n">year</span>
       <span class="c1"># Error: Trying to assign name &quot;released&quot; that is not in &quot;__slots__&quot; of type &quot;Album&quot;</span>
       <span class="bp">self</span><span class="o">.</span><span class="n">released</span> <span class="o">=</span> <span class="kc">True</span>

<span class="n">my_album</span> <span class="o">=</span> <span class="n">Album</span><span class="p">(</span><span class="s1">&#39;Songs about Python&#39;</span><span class="p">,</span> <span class="mi">2021</span><span class="p">)</span>
</pre></div>
</div>
<p>Mypy will only check attribute assignments against <code class="docutils literal notranslate"><span class="pre">__slots__</span></code> when
the following conditions hold:</p>
<ol class="arabic simple">
<li><p>All base classes (except builtin ones) must have explicit
<code class="docutils literal notranslate"><span class="pre">__slots__</span></code> defined (this mirrors Python semantics).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">__slots__</span></code> does not include <code class="docutils literal notranslate"><span class="pre">__dict__</span></code>. If <code class="docutils literal notranslate"><span class="pre">__slots__</span></code>
includes <code class="docutils literal notranslate"><span class="pre">__dict__</span></code>, arbitrary attributes can be set, similar to
when <code class="docutils literal notranslate"><span class="pre">__slots__</span></code> is not defined (this mirrors Python semantics).</p></li>
<li><p>All values in <code class="docutils literal notranslate"><span class="pre">__slots__</span></code> must be string literals.</p></li>
</ol>
</section>
</section>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <div>
    <h3><a href="index.html">目录</a></h3>
    <ul>
<li><a class="reference internal" href="#">Class basics</a><ul>
<li><a class="reference internal" href="#instance-and-class-attributes">Instance and class attributes</a></li>
<li><a class="reference internal" href="#annotating-init-methods">Annotating __init__ methods</a></li>
<li><a class="reference internal" href="#class-attribute-annotations">Class attribute annotations</a></li>
<li><a class="reference internal" href="#overriding-statically-typed-methods">Overriding statically typed methods</a></li>
<li><a class="reference internal" href="#abstract-base-classes-and-multiple-inheritance">Abstract base classes and multiple inheritance</a></li>
<li><a class="reference internal" href="#slots">Slots</a></li>
</ul>
</li>
</ul>

  </div>
  <div>
    <h4>上一个主题</h4>
    <p class="topless"><a href="kinds_of_types.html"
                          title="上一章">Kinds of types</a></p>
  </div>
  <div>
    <h4>下一个主题</h4>
    <p class="topless"><a href="runtime_troubles.html"
                          title="下一章">Annotation issues at runtime</a></p>
  </div>
  <div role="note" aria-label="source link">
    <h3>本页</h3>
    <ul class="this-page-menu">
      <li><a href="_sources/class_basics.rst.txt"
            rel="nofollow">显示源代码</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">快速搜索</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="转向" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>导航</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="总目录"
             >索引</a></li>
        <li class="right" >
          <a href="runtime_troubles.html" title="Annotation issues at runtime"
             >下一页</a> |</li>
        <li class="right" >
          <a href="kinds_of_types.html" title="Kinds of types"
             >上一页</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">Mypy 0.940+dev.7f0839b552c99f62636632bfd44522e91b26dc54 文档</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">Class basics</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; 版权所有 2016, Jukka Lehtosalo.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 4.4.0.
    </div>
  </body>
</html>