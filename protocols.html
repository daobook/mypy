
<!DOCTYPE html>

<html lang="zh_CN">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Protocols and structural subtyping &#8212; Mypy 0.940+dev.7f0839b552c99f62636632bfd44522e91b26dc54 文档</title>
    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="_static/classic.css" />
    
    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/translations.js"></script>
    
    <link rel="index" title="索引" href="genindex.html" />
    <link rel="search" title="搜索" href="search.html" />
    <link rel="next" title="Dynamically typed code" href="dynamic_typing.html" />
    <link rel="prev" title="Annotation issues at runtime" href="runtime_troubles.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>导航</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="总目录"
             accesskey="I">索引</a></li>
        <li class="right" >
          <a href="dynamic_typing.html" title="Dynamically typed code"
             accesskey="N">下一页</a> |</li>
        <li class="right" >
          <a href="runtime_troubles.html" title="Annotation issues at runtime"
             accesskey="P">上一页</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">Mypy 0.940+dev.7f0839b552c99f62636632bfd44522e91b26dc54 文档</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">Protocols and structural subtyping</a></li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <section id="protocols-and-structural-subtyping">
<span id="protocol-types"></span><h1>Protocols and structural subtyping<a class="headerlink" href="#protocols-and-structural-subtyping" title="永久链接至标题">¶</a></h1>
<p>Mypy supports two ways of deciding whether two classes are compatible
as types: nominal subtyping and structural subtyping. <em>Nominal</em>
subtyping is strictly based on the class hierarchy. If class <code class="docutils literal notranslate"><span class="pre">D</span></code>
inherits class <code class="docutils literal notranslate"><span class="pre">C</span></code>, it’s also a subtype of <code class="docutils literal notranslate"><span class="pre">C</span></code>, and instances of
<code class="docutils literal notranslate"><span class="pre">D</span></code> can be used when <code class="docutils literal notranslate"><span class="pre">C</span></code> instances are expected. This form of
subtyping is used by default in mypy, since it’s easy to understand
and produces clear and concise error messages, and since it matches
how the native <a class="reference external" href="https://docs.python.org/3/library/functions.html#isinstance" title="(在 Python v3.10)"><code class="xref py py-func docutils literal notranslate"><span class="pre">isinstance</span></code></a> check works – based on class
hierarchy. <em>Structural</em> subtyping can also be useful. Class <code class="docutils literal notranslate"><span class="pre">D</span></code> is
a structural subtype of class <code class="docutils literal notranslate"><span class="pre">C</span></code> if the former has all attributes
and methods of the latter, and with compatible types.</p>
<p>Structural subtyping can be seen as a static equivalent of duck
typing, which is well known to Python programmers. Mypy provides
support for structural subtyping via protocol classes described
below.  See <span class="target" id="index-0"></span><a class="pep reference external" href="https://www.python.org/dev/peps/pep-0544"><strong>PEP 544</strong></a> for the detailed specification of protocols
and structural subtyping in Python.</p>
<section id="predefined-protocols">
<span id="id1"></span><h2>Predefined protocols<a class="headerlink" href="#predefined-protocols" title="永久链接至标题">¶</a></h2>
<p>The <a class="reference external" href="https://docs.python.org/3/library/typing.html#module-typing" title="(在 Python v3.10)"><code class="xref py py-mod docutils literal notranslate"><span class="pre">typing</span></code></a> module defines various protocol classes that correspond
to common Python protocols, such as <a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.Iterable" title="(在 Python v3.10)"><code class="xref py py-class docutils literal notranslate"><span class="pre">Iterable[T]</span></code></a>. If a class
defines a suitable <a class="reference external" href="https://docs.python.org/3/reference/datamodel.html#object.__iter__" title="(在 Python v3.10)"><code class="xref py py-meth docutils literal notranslate"><span class="pre">__iter__</span></code></a> method, mypy understands that it
implements the iterable protocol and is compatible with <a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.Iterable" title="(在 Python v3.10)"><code class="xref py py-class docutils literal notranslate"><span class="pre">Iterable[T]</span></code></a>.
For example, <code class="docutils literal notranslate"><span class="pre">IntList</span></code> below is iterable, over <code class="docutils literal notranslate"><span class="pre">int</span></code> values:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Iterator</span><span class="p">,</span> <span class="n">Iterable</span><span class="p">,</span> <span class="n">Optional</span>

<span class="k">class</span> <span class="nc">IntList</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">next</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="s1">&#39;IntList&#39;</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">value</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">next</span> <span class="o">=</span> <span class="nb">next</span>

    <span class="k">def</span> <span class="fm">__iter__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Iterator</span><span class="p">[</span><span class="nb">int</span><span class="p">]:</span>
        <span class="n">current</span> <span class="o">=</span> <span class="bp">self</span>
        <span class="k">while</span> <span class="n">current</span><span class="p">:</span>
            <span class="k">yield</span> <span class="n">current</span><span class="o">.</span><span class="n">value</span>
            <span class="n">current</span> <span class="o">=</span> <span class="n">current</span><span class="o">.</span><span class="n">next</span>

<span class="k">def</span> <span class="nf">print_numbered</span><span class="p">(</span><span class="n">items</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">[</span><span class="nb">int</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">n</span><span class="p">,</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">items</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">n</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>

<span class="n">x</span> <span class="o">=</span> <span class="n">IntList</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="n">IntList</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="kc">None</span><span class="p">))</span>
<span class="n">print_numbered</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>  <span class="c1"># OK</span>
<span class="n">print_numbered</span><span class="p">([</span><span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">])</span>  <span class="c1"># Also OK</span>
</pre></div>
</div>
<p>The subsections below introduce all built-in protocols defined in
<a class="reference external" href="https://docs.python.org/3/library/typing.html#module-typing" title="(在 Python v3.10)"><code class="xref py py-mod docutils literal notranslate"><span class="pre">typing</span></code></a> and the signatures of the corresponding methods you need to define
to implement each protocol (the signatures can be left out, as always, but mypy
won’t type check unannotated methods).</p>
<section id="iteration-protocols">
<h3>Iteration protocols<a class="headerlink" href="#iteration-protocols" title="永久链接至标题">¶</a></h3>
<p>The iteration protocols are useful in many contexts. For example, they allow
iteration of objects in for loops.</p>
<section id="iterable-t">
<h4>Iterable[T]<a class="headerlink" href="#iterable-t" title="永久链接至标题">¶</a></h4>
<p>The <a class="reference internal" href="#predefined-protocols"><span class="std std-ref">example above</span></a> has a simple implementation of an
<a class="reference external" href="https://docs.python.org/3/reference/datamodel.html#object.__iter__" title="(在 Python v3.10)"><code class="xref py py-meth docutils literal notranslate"><span class="pre">__iter__</span></code></a> method.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="fm">__iter__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Iterator</span><span class="p">[</span><span class="n">T</span><span class="p">]</span>
</pre></div>
</div>
<p>See also <a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.Iterable" title="(在 Python v3.10)"><code class="xref py py-class docutils literal notranslate"><span class="pre">Iterable</span></code></a>.</p>
</section>
<section id="iterator-t">
<h4>Iterator[T]<a class="headerlink" href="#iterator-t" title="永久链接至标题">¶</a></h4>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="fm">__next__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">T</span>
<span class="k">def</span> <span class="fm">__iter__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Iterator</span><span class="p">[</span><span class="n">T</span><span class="p">]</span>
</pre></div>
</div>
<p>See also <a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.Iterator" title="(在 Python v3.10)"><code class="xref py py-class docutils literal notranslate"><span class="pre">Iterator</span></code></a>.</p>
</section>
</section>
<section id="collection-protocols">
<h3>Collection protocols<a class="headerlink" href="#collection-protocols" title="永久链接至标题">¶</a></h3>
<p>Many of these are implemented by built-in container types such as
<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#list" title="(在 Python v3.10)"><code class="xref py py-class docutils literal notranslate"><span class="pre">list</span></code></a> and <a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#dict" title="(在 Python v3.10)"><code class="xref py py-class docutils literal notranslate"><span class="pre">dict</span></code></a>, and these are also useful for user-defined
collection objects.</p>
<section id="sized">
<h4>Sized<a class="headerlink" href="#sized" title="永久链接至标题">¶</a></h4>
<p>This is a type for objects that support <a class="reference external" href="https://docs.python.org/3/library/functions.html#len" title="(在 Python v3.10)"><code class="xref py py-func docutils literal notranslate"><span class="pre">len(x)</span></code></a>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="fm">__len__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span>
</pre></div>
</div>
<p>See also <a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.Sized" title="(在 Python v3.10)"><code class="xref py py-class docutils literal notranslate"><span class="pre">Sized</span></code></a>.</p>
</section>
<section id="container-t">
<h4>Container[T]<a class="headerlink" href="#container-t" title="永久链接至标题">¶</a></h4>
<p>This is a type for objects that support the <code class="docutils literal notranslate"><span class="pre">in</span></code> operator.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="fm">__contains__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span> <span class="nb">object</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span>
</pre></div>
</div>
<p>See also <a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.Container" title="(在 Python v3.10)"><code class="xref py py-class docutils literal notranslate"><span class="pre">Container</span></code></a>.</p>
</section>
<section id="collection-t">
<h4>Collection[T]<a class="headerlink" href="#collection-t" title="永久链接至标题">¶</a></h4>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="fm">__len__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span>
<span class="k">def</span> <span class="fm">__iter__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Iterator</span><span class="p">[</span><span class="n">T</span><span class="p">]</span>
<span class="k">def</span> <span class="fm">__contains__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span> <span class="nb">object</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span>
</pre></div>
</div>
<p>See also <a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.Collection" title="(在 Python v3.10)"><code class="xref py py-class docutils literal notranslate"><span class="pre">Collection</span></code></a>.</p>
</section>
</section>
<section id="one-off-protocols">
<h3>One-off protocols<a class="headerlink" href="#one-off-protocols" title="永久链接至标题">¶</a></h3>
<p>These protocols are typically only useful with a single standard
library function or class.</p>
<section id="reversible-t">
<h4>Reversible[T]<a class="headerlink" href="#reversible-t" title="永久链接至标题">¶</a></h4>
<p>This is a type for objects that support <a class="reference external" href="https://docs.python.org/3/library/functions.html#reversed" title="(在 Python v3.10)"><code class="xref py py-func docutils literal notranslate"><span class="pre">reversed(x)</span></code></a>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="fm">__reversed__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Iterator</span><span class="p">[</span><span class="n">T</span><span class="p">]</span>
</pre></div>
</div>
<p>See also <a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.Reversible" title="(在 Python v3.10)"><code class="xref py py-class docutils literal notranslate"><span class="pre">Reversible</span></code></a>.</p>
</section>
<section id="supportsabs-t">
<h4>SupportsAbs[T]<a class="headerlink" href="#supportsabs-t" title="永久链接至标题">¶</a></h4>
<p>This is a type for objects that support <a class="reference external" href="https://docs.python.org/3/library/functions.html#abs" title="(在 Python v3.10)"><code class="xref py py-func docutils literal notranslate"><span class="pre">abs(x)</span></code></a>. <code class="docutils literal notranslate"><span class="pre">T</span></code> is the type of
value returned by <a class="reference external" href="https://docs.python.org/3/library/functions.html#abs" title="(在 Python v3.10)"><code class="xref py py-func docutils literal notranslate"><span class="pre">abs(x)</span></code></a>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="fm">__abs__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">T</span>
</pre></div>
</div>
<p>See also <a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.SupportsAbs" title="(在 Python v3.10)"><code class="xref py py-class docutils literal notranslate"><span class="pre">SupportsAbs</span></code></a>.</p>
</section>
<section id="supportsbytes">
<h4>SupportsBytes<a class="headerlink" href="#supportsbytes" title="永久链接至标题">¶</a></h4>
<p>This is a type for objects that support <a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#bytes" title="(在 Python v3.10)"><code class="xref py py-class docutils literal notranslate"><span class="pre">bytes(x)</span></code></a>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="fm">__bytes__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bytes</span>
</pre></div>
</div>
<p>See also <a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.SupportsBytes" title="(在 Python v3.10)"><code class="xref py py-class docutils literal notranslate"><span class="pre">SupportsBytes</span></code></a>.</p>
</section>
<section id="supportscomplex">
<span id="supports-int-etc"></span><h4>SupportsComplex<a class="headerlink" href="#supportscomplex" title="永久链接至标题">¶</a></h4>
<p>This is a type for objects that support <a class="reference external" href="https://docs.python.org/3/library/functions.html#complex" title="(在 Python v3.10)"><code class="xref py py-class docutils literal notranslate"><span class="pre">complex(x)</span></code></a>. Note that no arithmetic operations
are supported.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="fm">__complex__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">complex</span>
</pre></div>
</div>
<p>See also <a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.SupportsComplex" title="(在 Python v3.10)"><code class="xref py py-class docutils literal notranslate"><span class="pre">SupportsComplex</span></code></a>.</p>
</section>
<section id="supportsfloat">
<h4>SupportsFloat<a class="headerlink" href="#supportsfloat" title="永久链接至标题">¶</a></h4>
<p>This is a type for objects that support <a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(在 Python v3.10)"><code class="xref py py-class docutils literal notranslate"><span class="pre">float(x)</span></code></a>. Note that no arithmetic operations
are supported.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="fm">__float__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span>
</pre></div>
</div>
<p>See also <a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.SupportsFloat" title="(在 Python v3.10)"><code class="xref py py-class docutils literal notranslate"><span class="pre">SupportsFloat</span></code></a>.</p>
</section>
<section id="supportsint">
<h4>SupportsInt<a class="headerlink" href="#supportsint" title="永久链接至标题">¶</a></h4>
<p>This is a type for objects that support <a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(在 Python v3.10)"><code class="xref py py-class docutils literal notranslate"><span class="pre">int(x)</span></code></a>. Note that no arithmetic operations
are supported.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="fm">__int__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span>
</pre></div>
</div>
<p>See also <a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.SupportsInt" title="(在 Python v3.10)"><code class="xref py py-class docutils literal notranslate"><span class="pre">SupportsInt</span></code></a>.</p>
</section>
<section id="supportsround-t">
<h4>SupportsRound[T]<a class="headerlink" href="#supportsround-t" title="永久链接至标题">¶</a></h4>
<p>This is a type for objects that support <a class="reference external" href="https://docs.python.org/3/library/functions.html#round" title="(在 Python v3.10)"><code class="xref py py-func docutils literal notranslate"><span class="pre">round(x)</span></code></a>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="fm">__round__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">T</span>
</pre></div>
</div>
<p>See also <a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.SupportsRound" title="(在 Python v3.10)"><code class="xref py py-class docutils literal notranslate"><span class="pre">SupportsRound</span></code></a>.</p>
</section>
</section>
<section id="async-protocols">
<h3>Async protocols<a class="headerlink" href="#async-protocols" title="永久链接至标题">¶</a></h3>
<p>These protocols can be useful in async code. See <a class="reference internal" href="more_types.html#async-and-await"><span class="std std-ref">Typing async/await</span></a>
for more information.</p>
<section id="awaitable-t">
<h4>Awaitable[T]<a class="headerlink" href="#awaitable-t" title="永久链接至标题">¶</a></h4>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="fm">__await__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Generator</span><span class="p">[</span><span class="n">Any</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="n">T</span><span class="p">]</span>
</pre></div>
</div>
<p>See also <a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.Awaitable" title="(在 Python v3.10)"><code class="xref py py-class docutils literal notranslate"><span class="pre">Awaitable</span></code></a>.</p>
</section>
<section id="asynciterable-t">
<h4>AsyncIterable[T]<a class="headerlink" href="#asynciterable-t" title="永久链接至标题">¶</a></h4>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="fm">__aiter__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">AsyncIterator</span><span class="p">[</span><span class="n">T</span><span class="p">]</span>
</pre></div>
</div>
<p>See also <a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.AsyncIterable" title="(在 Python v3.10)"><code class="xref py py-class docutils literal notranslate"><span class="pre">AsyncIterable</span></code></a>.</p>
</section>
<section id="asynciterator-t">
<h4>AsyncIterator[T]<a class="headerlink" href="#asynciterator-t" title="永久链接至标题">¶</a></h4>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="fm">__anext__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Awaitable</span><span class="p">[</span><span class="n">T</span><span class="p">]</span>
<span class="k">def</span> <span class="fm">__aiter__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">AsyncIterator</span><span class="p">[</span><span class="n">T</span><span class="p">]</span>
</pre></div>
</div>
<p>See also <a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.AsyncIterator" title="(在 Python v3.10)"><code class="xref py py-class docutils literal notranslate"><span class="pre">AsyncIterator</span></code></a>.</p>
</section>
</section>
<section id="context-manager-protocols">
<h3>Context manager protocols<a class="headerlink" href="#context-manager-protocols" title="永久链接至标题">¶</a></h3>
<p>There are two protocols for context managers – one for regular context
managers and one for async ones. These allow defining objects that can
be used in <code class="docutils literal notranslate"><span class="pre">with</span></code> and <code class="docutils literal notranslate"><span class="pre">async</span> <span class="pre">with</span></code> statements.</p>
<section id="contextmanager-t">
<h4>ContextManager[T]<a class="headerlink" href="#contextmanager-t" title="永久链接至标题">¶</a></h4>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="fm">__enter__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">T</span>
<span class="k">def</span> <span class="fm">__exit__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
             <span class="n">exc_type</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Type</span><span class="p">[</span><span class="ne">BaseException</span><span class="p">]],</span>
             <span class="n">exc_value</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="ne">BaseException</span><span class="p">],</span>
             <span class="n">traceback</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">TracebackType</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span>
</pre></div>
</div>
<p>See also <a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.ContextManager" title="(在 Python v3.10)"><code class="xref py py-class docutils literal notranslate"><span class="pre">ContextManager</span></code></a>.</p>
</section>
<section id="asynccontextmanager-t">
<h4>AsyncContextManager[T]<a class="headerlink" href="#asynccontextmanager-t" title="永久链接至标题">¶</a></h4>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="fm">__aenter__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Awaitable</span><span class="p">[</span><span class="n">T</span><span class="p">]</span>
<span class="k">def</span> <span class="fm">__aexit__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
              <span class="n">exc_type</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Type</span><span class="p">[</span><span class="ne">BaseException</span><span class="p">]],</span>
              <span class="n">exc_value</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="ne">BaseException</span><span class="p">],</span>
              <span class="n">traceback</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">TracebackType</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Awaitable</span><span class="p">[</span><span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]]</span>
</pre></div>
</div>
<p>See also <a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.AsyncContextManager" title="(在 Python v3.10)"><code class="xref py py-class docutils literal notranslate"><span class="pre">AsyncContextManager</span></code></a>.</p>
</section>
</section>
</section>
<section id="simple-user-defined-protocols">
<h2>Simple user-defined protocols<a class="headerlink" href="#simple-user-defined-protocols" title="永久链接至标题">¶</a></h2>
<p>You can define your own protocol class by inheriting the special <code class="docutils literal notranslate"><span class="pre">Protocol</span></code>
class:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Iterable</span>
<span class="kn">from</span> <span class="nn">typing_extensions</span> <span class="kn">import</span> <span class="n">Protocol</span>

<span class="k">class</span> <span class="nc">SupportsClose</span><span class="p">(</span><span class="n">Protocol</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">close</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
       <span class="o">...</span>  <span class="c1"># Empty method body (explicit &#39;...&#39;)</span>

<span class="k">class</span> <span class="nc">Resource</span><span class="p">:</span>  <span class="c1"># No SupportsClose base class!</span>
    <span class="c1"># ... some methods ...</span>

    <span class="k">def</span> <span class="nf">close</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
       <span class="bp">self</span><span class="o">.</span><span class="n">resource</span><span class="o">.</span><span class="n">release</span><span class="p">()</span>

<span class="k">def</span> <span class="nf">close_all</span><span class="p">(</span><span class="n">items</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">[</span><span class="n">SupportsClose</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">items</span><span class="p">:</span>
        <span class="n">item</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

<span class="n">close_all</span><span class="p">([</span><span class="n">Resource</span><span class="p">(),</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;some/file&#39;</span><span class="p">)])</span>  <span class="c1"># Okay!</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">Resource</span></code> is a subtype of the <code class="docutils literal notranslate"><span class="pre">SupportsClose</span></code> protocol since it defines
a compatible <code class="docutils literal notranslate"><span class="pre">close</span></code> method. Regular file objects returned by <a class="reference external" href="https://docs.python.org/3/library/functions.html#open" title="(在 Python v3.10)"><code class="xref py py-func docutils literal notranslate"><span class="pre">open()</span></code></a> are
similarly compatible with the protocol, as they support <code class="docutils literal notranslate"><span class="pre">close()</span></code>.</p>
<div class="admonition note">
<p class="admonition-title">备注</p>
<p>The <code class="docutils literal notranslate"><span class="pre">Protocol</span></code> base class is provided in the <code class="docutils literal notranslate"><span class="pre">typing_extensions</span></code>
package for Python 2.7 and 3.4-3.7. Starting with Python 3.8, <code class="docutils literal notranslate"><span class="pre">Protocol</span></code>
is included in the <code class="docutils literal notranslate"><span class="pre">typing</span></code> module.</p>
</div>
</section>
<section id="defining-subprotocols-and-subclassing-protocols">
<h2>Defining subprotocols and subclassing protocols<a class="headerlink" href="#defining-subprotocols-and-subclassing-protocols" title="永久链接至标题">¶</a></h2>
<p>You can also define subprotocols. Existing protocols can be extended
and merged using multiple inheritance. Example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># ... continuing from the previous example</span>

<span class="k">class</span> <span class="nc">SupportsRead</span><span class="p">(</span><span class="n">Protocol</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">read</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">amount</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bytes</span><span class="p">:</span> <span class="o">...</span>

<span class="k">class</span> <span class="nc">TaggedReadableResource</span><span class="p">(</span><span class="n">SupportsClose</span><span class="p">,</span> <span class="n">SupportsRead</span><span class="p">,</span> <span class="n">Protocol</span><span class="p">):</span>
    <span class="n">label</span><span class="p">:</span> <span class="nb">str</span>

<span class="k">class</span> <span class="nc">AdvancedResource</span><span class="p">(</span><span class="n">Resource</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">label</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">label</span> <span class="o">=</span> <span class="n">label</span>

    <span class="k">def</span> <span class="nf">read</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">amount</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bytes</span><span class="p">:</span>
        <span class="c1"># some implementation</span>
        <span class="o">...</span>

<span class="n">resource</span><span class="p">:</span> <span class="n">TaggedReadableResource</span>
<span class="n">resource</span> <span class="o">=</span> <span class="n">AdvancedResource</span><span class="p">(</span><span class="s1">&#39;handle with care&#39;</span><span class="p">)</span>  <span class="c1"># OK</span>
</pre></div>
</div>
<p>Note that inheriting from an existing protocol does not automatically
turn the subclass into a protocol – it just creates a regular
(non-protocol) class or ABC that implements the given protocol (or
protocols). The <code class="docutils literal notranslate"><span class="pre">Protocol</span></code> base class must always be explicitly
present if you are defining a protocol:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">NotAProtocol</span><span class="p">(</span><span class="n">SupportsClose</span><span class="p">):</span>  <span class="c1"># This is NOT a protocol</span>
    <span class="n">new_attr</span><span class="p">:</span> <span class="nb">int</span>

<span class="k">class</span> <span class="nc">Concrete</span><span class="p">:</span>
   <span class="n">new_attr</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span>

   <span class="k">def</span> <span class="nf">close</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
       <span class="o">...</span>

<span class="c1"># Error: nominal subtyping used by default</span>
<span class="n">x</span><span class="p">:</span> <span class="n">NotAProtocol</span> <span class="o">=</span> <span class="n">Concrete</span><span class="p">()</span>  <span class="c1"># Error!</span>
</pre></div>
</div>
<p>You can also include default implementations of methods in
protocols. If you explicitly subclass these protocols you can inherit
these default implementations. Explicitly including a protocol as a
base class is also a way of documenting that your class implements a
particular protocol, and it forces mypy to verify that your class
implementation is actually compatible with the protocol.</p>
<div class="admonition note">
<p class="admonition-title">备注</p>
<p>You can use Python 3.6 variable annotations (<span class="target" id="index-1"></span><a class="pep reference external" href="https://www.python.org/dev/peps/pep-0526"><strong>PEP 526</strong></a>)
to declare protocol attributes.  On Python 2.7 and earlier Python 3
versions you can use type comments and properties.</p>
</div>
</section>
<section id="recursive-protocols">
<h2>Recursive protocols<a class="headerlink" href="#recursive-protocols" title="永久链接至标题">¶</a></h2>
<p>Protocols can be recursive (self-referential) and mutually
recursive. This is useful for declaring abstract recursive collections
such as trees and linked lists:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">TypeVar</span><span class="p">,</span> <span class="n">Optional</span>
<span class="kn">from</span> <span class="nn">typing_extensions</span> <span class="kn">import</span> <span class="n">Protocol</span>

<span class="k">class</span> <span class="nc">TreeLike</span><span class="p">(</span><span class="n">Protocol</span><span class="p">):</span>
    <span class="n">value</span><span class="p">:</span> <span class="nb">int</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">left</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="s1">&#39;TreeLike&#39;</span><span class="p">]:</span> <span class="o">...</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">right</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="s1">&#39;TreeLike&#39;</span><span class="p">]:</span> <span class="o">...</span>

<span class="k">class</span> <span class="nc">SimpleTree</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">value</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">left</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="s1">&#39;SimpleTree&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">right</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="s1">&#39;SimpleTree&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>

<span class="n">root</span><span class="p">:</span> <span class="n">TreeLike</span> <span class="o">=</span> <span class="n">SimpleTree</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>  <span class="c1"># OK</span>
</pre></div>
</div>
</section>
<section id="using-isinstance-with-protocols">
<h2>Using isinstance() with protocols<a class="headerlink" href="#using-isinstance-with-protocols" title="永久链接至标题">¶</a></h2>
<p>You can use a protocol class with <a class="reference external" href="https://docs.python.org/3/library/functions.html#isinstance" title="(在 Python v3.10)"><code class="xref py py-func docutils literal notranslate"><span class="pre">isinstance()</span></code></a> if you decorate it
with the <code class="docutils literal notranslate"><span class="pre">&#64;runtime_checkable</span></code> class decorator. The decorator adds
support for basic runtime structural checks:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">typing_extensions</span> <span class="kn">import</span> <span class="n">Protocol</span><span class="p">,</span> <span class="n">runtime_checkable</span>

<span class="nd">@runtime_checkable</span>
<span class="k">class</span> <span class="nc">Portable</span><span class="p">(</span><span class="n">Protocol</span><span class="p">):</span>
    <span class="n">handles</span><span class="p">:</span> <span class="nb">int</span>

<span class="k">class</span> <span class="nc">Mug</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">handles</span> <span class="o">=</span> <span class="mi">1</span>

<span class="k">def</span> <span class="nf">use</span><span class="p">(</span><span class="n">handles</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span> <span class="o">...</span>

<span class="n">mug</span> <span class="o">=</span> <span class="n">Mug</span><span class="p">()</span>
<span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">mug</span><span class="p">,</span> <span class="n">Portable</span><span class="p">):</span>
   <span class="n">use</span><span class="p">(</span><span class="n">mug</span><span class="o">.</span><span class="n">handles</span><span class="p">)</span>  <span class="c1"># Works statically and at runtime</span>
</pre></div>
</div>
<p><a class="reference external" href="https://docs.python.org/3/library/functions.html#isinstance" title="(在 Python v3.10)"><code class="xref py py-func docutils literal notranslate"><span class="pre">isinstance()</span></code></a> also works with the <a class="reference internal" href="#predefined-protocols"><span class="std std-ref">predefined protocols</span></a>
in <a class="reference external" href="https://docs.python.org/3/library/typing.html#module-typing" title="(在 Python v3.10)"><code class="xref py py-mod docutils literal notranslate"><span class="pre">typing</span></code></a> such as <a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.Iterable" title="(在 Python v3.10)"><code class="xref py py-class docutils literal notranslate"><span class="pre">Iterable</span></code></a>.</p>
<div class="admonition note">
<p class="admonition-title">备注</p>
<p><a class="reference external" href="https://docs.python.org/3/library/functions.html#isinstance" title="(在 Python v3.10)"><code class="xref py py-func docutils literal notranslate"><span class="pre">isinstance()</span></code></a> with protocols is not completely safe at runtime.
For example, signatures of methods are not checked. The runtime
implementation only checks that all protocol members are defined.</p>
</div>
</section>
<section id="callback-protocols">
<span id="id2"></span><h2>Callback protocols<a class="headerlink" href="#callback-protocols" title="永久链接至标题">¶</a></h2>
<p>Protocols can be used to define flexible callback types that are hard
(or even impossible) to express using the <a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.Callable" title="(在 Python v3.10)"><code class="xref py py-data docutils literal notranslate"><span class="pre">Callable[...]</span></code></a> syntax, such as variadic,
overloaded, and complex generic callbacks. They are defined with a special <a class="reference external" href="https://docs.python.org/3/reference/datamodel.html#object.__call__" title="(在 Python v3.10)"><code class="xref py py-meth docutils literal notranslate"><span class="pre">__call__</span></code></a>
member:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Optional</span><span class="p">,</span> <span class="n">Iterable</span>
<span class="kn">from</span> <span class="nn">typing_extensions</span> <span class="kn">import</span> <span class="n">Protocol</span>

<span class="k">class</span> <span class="nc">Combiner</span><span class="p">(</span><span class="n">Protocol</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">vals</span><span class="p">:</span> <span class="nb">bytes</span><span class="p">,</span> <span class="n">maxlen</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">bytes</span><span class="p">]:</span> <span class="o">...</span>

<span class="k">def</span> <span class="nf">batch_proc</span><span class="p">(</span><span class="n">data</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">[</span><span class="nb">bytes</span><span class="p">],</span> <span class="n">cb_results</span><span class="p">:</span> <span class="n">Combiner</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bytes</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
        <span class="o">...</span>

<span class="k">def</span> <span class="nf">good_cb</span><span class="p">(</span><span class="o">*</span><span class="n">vals</span><span class="p">:</span> <span class="nb">bytes</span><span class="p">,</span> <span class="n">maxlen</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">bytes</span><span class="p">]:</span>
    <span class="o">...</span>
<span class="k">def</span> <span class="nf">bad_cb</span><span class="p">(</span><span class="o">*</span><span class="n">vals</span><span class="p">:</span> <span class="nb">bytes</span><span class="p">,</span> <span class="n">maxitems</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">bytes</span><span class="p">]:</span>
    <span class="o">...</span>

<span class="n">batch_proc</span><span class="p">([],</span> <span class="n">good_cb</span><span class="p">)</span>  <span class="c1"># OK</span>
<span class="n">batch_proc</span><span class="p">([],</span> <span class="n">bad_cb</span><span class="p">)</span>   <span class="c1"># Error! Argument 2 has incompatible type because of</span>
                         <span class="c1"># different name and kind in the callback</span>
</pre></div>
</div>
<p>Callback protocols and <a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.Callable" title="(在 Python v3.10)"><code class="xref py py-data docutils literal notranslate"><span class="pre">Callable</span></code></a> types can be used interchangeably.
Keyword argument names in <a class="reference external" href="https://docs.python.org/3/reference/datamodel.html#object.__call__" title="(在 Python v3.10)"><code class="xref py py-meth docutils literal notranslate"><span class="pre">__call__</span></code></a> methods must be identical, unless
a double underscore prefix is used. For example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Callable</span><span class="p">,</span> <span class="n">TypeVar</span>
<span class="kn">from</span> <span class="nn">typing_extensions</span> <span class="kn">import</span> <span class="n">Protocol</span>

<span class="n">T</span> <span class="o">=</span> <span class="n">TypeVar</span><span class="p">(</span><span class="s1">&#39;T&#39;</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">Copy</span><span class="p">(</span><span class="n">Protocol</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">__origin</span><span class="p">:</span> <span class="n">T</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">T</span><span class="p">:</span> <span class="o">...</span>

<span class="n">copy_a</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[[</span><span class="n">T</span><span class="p">],</span> <span class="n">T</span><span class="p">]</span>
<span class="n">copy_b</span><span class="p">:</span> <span class="n">Copy</span>

<span class="n">copy_a</span> <span class="o">=</span> <span class="n">copy_b</span>  <span class="c1"># OK</span>
<span class="n">copy_b</span> <span class="o">=</span> <span class="n">copy_a</span>  <span class="c1"># Also OK</span>
</pre></div>
</div>
</section>
</section>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <div>
    <h3><a href="index.html">目录</a></h3>
    <ul>
<li><a class="reference internal" href="#">Protocols and structural subtyping</a><ul>
<li><a class="reference internal" href="#predefined-protocols">Predefined protocols</a><ul>
<li><a class="reference internal" href="#iteration-protocols">Iteration protocols</a><ul>
<li><a class="reference internal" href="#iterable-t">Iterable[T]</a></li>
<li><a class="reference internal" href="#iterator-t">Iterator[T]</a></li>
</ul>
</li>
<li><a class="reference internal" href="#collection-protocols">Collection protocols</a><ul>
<li><a class="reference internal" href="#sized">Sized</a></li>
<li><a class="reference internal" href="#container-t">Container[T]</a></li>
<li><a class="reference internal" href="#collection-t">Collection[T]</a></li>
</ul>
</li>
<li><a class="reference internal" href="#one-off-protocols">One-off protocols</a><ul>
<li><a class="reference internal" href="#reversible-t">Reversible[T]</a></li>
<li><a class="reference internal" href="#supportsabs-t">SupportsAbs[T]</a></li>
<li><a class="reference internal" href="#supportsbytes">SupportsBytes</a></li>
<li><a class="reference internal" href="#supportscomplex">SupportsComplex</a></li>
<li><a class="reference internal" href="#supportsfloat">SupportsFloat</a></li>
<li><a class="reference internal" href="#supportsint">SupportsInt</a></li>
<li><a class="reference internal" href="#supportsround-t">SupportsRound[T]</a></li>
</ul>
</li>
<li><a class="reference internal" href="#async-protocols">Async protocols</a><ul>
<li><a class="reference internal" href="#awaitable-t">Awaitable[T]</a></li>
<li><a class="reference internal" href="#asynciterable-t">AsyncIterable[T]</a></li>
<li><a class="reference internal" href="#asynciterator-t">AsyncIterator[T]</a></li>
</ul>
</li>
<li><a class="reference internal" href="#context-manager-protocols">Context manager protocols</a><ul>
<li><a class="reference internal" href="#contextmanager-t">ContextManager[T]</a></li>
<li><a class="reference internal" href="#asynccontextmanager-t">AsyncContextManager[T]</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#simple-user-defined-protocols">Simple user-defined protocols</a></li>
<li><a class="reference internal" href="#defining-subprotocols-and-subclassing-protocols">Defining subprotocols and subclassing protocols</a></li>
<li><a class="reference internal" href="#recursive-protocols">Recursive protocols</a></li>
<li><a class="reference internal" href="#using-isinstance-with-protocols">Using isinstance() with protocols</a></li>
<li><a class="reference internal" href="#callback-protocols">Callback protocols</a></li>
</ul>
</li>
</ul>

  </div>
  <div>
    <h4>上一个主题</h4>
    <p class="topless"><a href="runtime_troubles.html"
                          title="上一章">Annotation issues at runtime</a></p>
  </div>
  <div>
    <h4>下一个主题</h4>
    <p class="topless"><a href="dynamic_typing.html"
                          title="下一章">Dynamically typed code</a></p>
  </div>
  <div role="note" aria-label="source link">
    <h3>本页</h3>
    <ul class="this-page-menu">
      <li><a href="_sources/protocols.rst.txt"
            rel="nofollow">显示源代码</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">快速搜索</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="转向" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>导航</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="总目录"
             >索引</a></li>
        <li class="right" >
          <a href="dynamic_typing.html" title="Dynamically typed code"
             >下一页</a> |</li>
        <li class="right" >
          <a href="runtime_troubles.html" title="Annotation issues at runtime"
             >上一页</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">Mypy 0.940+dev.7f0839b552c99f62636632bfd44522e91b26dc54 文档</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">Protocols and structural subtyping</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; 版权所有 2016, Jukka Lehtosalo.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 4.4.0.
    </div>
  </body>
</html>